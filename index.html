<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VexiumAI ‚Äî Database Dashboard</title>
    <meta name="description" content="Premium database administration dashboard by VexiumAI">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Animated Background -->
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <!-- Login Screen -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <div class="login-logo">
                <img src="logo.svg" alt="VexiumAI" width="48" height="48">
                <h1 class="login-title">VexiumDB</h1>
                <p class="login-subtitle">Database Administration Dashboard</p>
            </div>
            <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="login-field">
                    <label for="loginUser">Usuario</label>
                    <div class="login-input-wrap">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        <input type="text" id="loginUser" placeholder="admin" autocomplete="username" required>
                    </div>
                </div>
                <div class="login-field">
                    <label for="loginPass">Contrase√±a</label>
                    <div class="login-input-wrap">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                        </svg>
                        <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"
                            required>
                    </div>
                </div>
                <div class="login-error" id="loginError" style="display:none;"></div>
                <button type="submit" class="login-btn" id="loginBtn">
                    <span class="login-btn-text">Iniciar Sesi√≥n</span>
                    <div class="login-spinner" style="display:none;"></div>
                </button>
            </form>
            <div class="login-footer">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                </svg>
                <span>Conexi√≥n segura con n8n</span>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-logo">
            <div class="logo-icon">
                <img src="logo.svg" alt="VexiumAI" width="32" height="32">
            </div>
            <span class="logo-text">VexiumDB</span>
        </div>

        <nav class="sidebar-nav">
            <button class="nav-item active" data-view="dashboard" onclick="switchView('dashboard')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" rx="1" />
                    <rect x="14" y="3" width="7" height="7" rx="1" />
                    <rect x="3" y="14" width="7" height="7" rx="1" />
                    <rect x="14" y="14" width="7" height="7" rx="1" />
                </svg>
                <span>Dashboard</span>
            </button>
            <button class="nav-item" data-view="tables" onclick="switchView('tables')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 3C7 3 3 5 3 7v10c0 2 4 4 9 4s9-2 9-4V7c0-2-4-4-9-4z" />
                    <path d="M3 12c0 2 4 4 9 4s9-2 9-4" />
                    <path d="M3 7c0 2 4 4 9 4s9-2 9-4" />
                </svg>
                <span>Tables</span>
            </button>
            <button class="nav-item" data-view="query" onclick="switchView('query')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 18 22 12 16 6" />
                    <polyline points="8 6 2 12 8 18" />
                    <line x1="14" y1="4" x2="10" y2="20" />
                </svg>
                <span>Query Editor</span>
            </button>
            <button class="nav-item" data-view="schema" onclick="switchView('schema')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83" />
                </svg>
                <span>Schema</span>
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="connection-status">
                <div class="status-dot connected"></div>
                <span>Connected</span>
            </div>
            <button class="logout-btn" id="logoutBtn" onclick="handleLogout()" title="Cerrar Sesi√≥n">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                <span>Salir</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
            </div>
            <div class="topbar-right">
                <div class="topbar-search">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="M21 21l-4.35-4.35" />
                    </svg>
                    <input type="text" placeholder="Search tables, columns..." id="globalSearch">
                </div>
                <div class="api-url-display">
                    <label>API URL:</label>
                    <input type="text" id="apiUrl" value="https://n8n.vexiumai.com/webhook/vexium-api" class="api-input"
                        placeholder="https://your-n8n.com/webhook">
                </div>
            </div>
        </header>

        <!-- Dashboard View -->
        <div class="view active" id="view-dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon cyan">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 3C7 3 3 5 3 7v10c0 2 4 4 9 4s9-2 9-4V7c0-2-4-4-9-4z" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="totalTables">‚Äî</span>
                        <span class="stat-label">Total Tables</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 3h18v18H3z" />
                            <path d="M3 9h18" />
                            <path d="M3 15h18" />
                            <path d="M9 3v18" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="totalRows">‚Äî</span>
                        <span class="stat-label">Total Rows</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2v20M2 12h20" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="totalColumns">‚Äî</span>
                        <span class="stat-label">Total Columns</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="dbSize">‚Äî</span>
                        <span class="stat-label">DB Size</span>
                    </div>
                </div>
            </div>

            <div class="panel-grid">
                <div class="glass-panel tables-panel">
                    <div class="panel-header">
                        <h2>üìä Tables Overview</h2>
                        <button class="btn-glow btn-sm" onclick="openModal('createTable')">+ New Table</button>
                    </div>
                    <div class="panel-body" id="tablesOverview">
                        <div class="loading-skeleton">
                            <div class="skeleton-row"></div>
                            <div class="skeleton-row"></div>
                            <div class="skeleton-row"></div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel activity-panel">
                    <div class="panel-header">
                        <h2>‚ö° Quick Actions</h2>
                    </div>
                    <div class="panel-body quick-actions">
                        <button class="action-card" onclick="openModal('createTable')">
                            <div class="action-icon cyan">Ôºã</div>
                            <span>Create Table</span>
                        </button>
                        <button class="action-card" onclick="switchView('query')">
                            <div class="action-icon purple">‚ñ∏</div>
                            <span>Run Query</span>
                        </button>
                        <button class="action-card" onclick="exportAllData()">
                            <div class="action-icon green">‚Üì</div>
                            <span>Export Data</span>
                        </button>
                        <button class="action-card" onclick="refreshDashboard()">
                            <div class="action-icon orange">‚Üª</div>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tables View -->
        <div class="view" id="view-tables">
            <div class="tables-header">
                <div class="table-selector">
                    <label>Select Table:</label>
                    <select id="tableSelect" onchange="loadTableData(this.value)">
                        <option value="">‚Äî Choose a table ‚Äî</option>
                    </select>
                </div>
                <div class="table-actions">
                    <button class="btn-glow btn-sm" onclick="openModal('insertRow')" id="btnInsertRow" disabled>+ Insert
                        Row</button>
                    <button class="btn-outline btn-sm" onclick="refreshTableData()" id="btnRefresh" disabled>‚Üª
                        Refresh</button>
                </div>
            </div>

            <div class="glass-panel schema-info-panel" id="schemaInfoPanel" style="display:none;">
                <div class="panel-header">
                    <h2 id="selectedTableName">Table Schema</h2>
                    <div class="schema-badges" id="schemaBadges"></div>
                </div>
                <div class="columns-grid" id="columnsGrid"></div>
            </div>

            <!-- Search / Filter Bar -->
            <div class="glass-panel filter-bar" id="filterBar" style="display:none;">
                <div class="filter-bar-inner">
                    <div class="filter-search-group">
                        <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <path d="M21 21l-4.35-4.35" />
                        </svg>
                        <select id="filterColumn" class="filter-column-select">
                            <option value="__all__">All Columns</option>
                        </select>
                        <input type="text" id="filterSearch" class="filter-search-input"
                            placeholder="Search by phone, username, ID..." autocomplete="off">
                        <button class="btn-icon filter-clear-btn" id="filterClearBtn" title="Clear filter"
                            style="display:none;" onclick="clearFilter()">‚úï</button>
                    </div>
                    <div class="filter-chips" id="filterChips">
                        <button class="filter-chip" data-platform="all" onclick="filterByPlatform('all')">
                            üåê All
                        </button>
                        <button class="filter-chip" data-platform="whatsapp" onclick="filterByPlatform('whatsapp')">
                            üü¢ WhatsApp
                        </button>
                        <button class="filter-chip" data-platform="messenger" onclick="filterByPlatform('messenger')">
                            üîµ Messenger
                        </button>
                        <button class="filter-chip" data-platform="instagram" onclick="filterByPlatform('instagram')">
                            üü£ Instagram
                        </button>
                    </div>
                    <span class="filter-result-count" id="filterResultCount"></span>
                </div>
            </div>

            <div class="glass-panel data-panel">
                <div class="panel-header">
                    <h2>üìã Data</h2>
                    <div class="data-controls">
                        <div class="view-toggle" id="viewToggle" style="display:none;">
                            <button class="view-btn active" data-view="conversations"
                                onclick="setViewMode('conversations')" title="One row per contact">
                                üí¨ Conversaciones
                            </button>
                            <button class="view-btn" data-view="all" onclick="setViewMode('all')"
                                title="Full message history">
                                üìú Todo
                            </button>
                        </div>
                        <span class="row-count" id="rowCount">0 rows</span>
                        <button class="btn-outline btn-xs" onclick="exportTableCSV()" id="btnExport" disabled>Export
                            CSV</button>
                    </div>
                </div>
                <div class="data-grid-wrapper">
                    <table class="data-grid" id="dataGrid">
                        <thead id="dataGridHead"></thead>
                        <tbody id="dataGridBody">
                            <tr>
                                <td class="empty-state" colspan="100">Select a table to view data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Query Editor View -->
        <div class="view" id="view-query">
            <div class="query-layout">
                <div class="glass-panel query-editor-panel">
                    <div class="panel-header">
                        <h2>üñ•Ô∏è SQL Query Editor</h2>
                        <div class="editor-actions">
                            <button class="btn-glow" onclick="executeQuery()" id="btnRunQuery">‚ñ∂ Run Query</button>
                            <button class="btn-outline btn-sm" onclick="formatSQL()">Format</button>
                            <button class="btn-outline btn-sm" onclick="clearEditor()">Clear</button>
                        </div>
                    </div>
                    <div class="editor-wrapper">
                        <div class="line-numbers" id="lineNumbers">1</div>
                        <textarea id="sqlEditor" class="sql-editor" spellcheck="false"
                            placeholder="-- Write your SQL query here...">-- Write your SQL query here
SELECT * FROM n8n_chat_histories LIMIT 10;</textarea>
                    </div>
                    <div class="editor-status">
                        <span id="queryStatus">Ready</span>
                        <span id="queryTime"></span>
                    </div>
                </div>

                <div class="glass-panel results-panel">
                    <div class="panel-header">
                        <h2>üìä Results</h2>
                        <span class="result-count" id="resultCount"></span>
                    </div>
                    <div class="data-grid-wrapper">
                        <table class="data-grid" id="resultsGrid">
                            <thead id="resultsHead"></thead>
                            <tbody id="resultsBody">
                                <tr>
                                    <td class="empty-state" colspan="100">Run a query to see results</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="glass-panel query-sidebar">
                <div class="panel-header">
                    <h2>üìÇ Tables</h2>
                </div>
                <div class="table-browser" id="tableBrowser"></div>
            </div>
        </div>

        <!-- Schema Manager View -->
        <div class="view" id="view-schema">
            <div class="schema-actions-bar">
                <button class="btn-glow btn-sm" onclick="openModal('createTable')">+ New Table</button>
                <button class="btn-outline btn-sm" onclick="loadSchema()">‚Üª Refresh Schema</button>
            </div>
            <div class="schema-grid" id="schemaGrid">
                <div class="loading-skeleton">
                    <div class="skeleton-row"></div>
                    <div class="skeleton-row"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalTitle">Modal</h3>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>

</html>